#! /bin/bash

# The MIT License (MIT)
# Copyright (c) 2016 Andreas Vollrath

# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is furnished
# to do so, subject to the following conditions:

# The above copyright notice and this permission notice shall be
# included in all copies or substantial portions of the Software.

# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
# INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
# PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
# HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE
# OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

#-------------------------------------------------------------------------------------------
# 	0.1 Check for right usage & set up basic Script Variables
if [ "$#" != "2" ]; then

	echo -e ""
	echo -e "------------------------------------------------------------------------------"
	echo -e " Open SAR Toolkit, version ${OST_VERSION}"
	echo -e " Clean up folders from intermediate products generated by the Open SAR Toolkit"
	echo -e "------------------------------------------------------------------------------"
	echo -e ""
	echo -e " Usage: ost_S1_cleanup <input directory> <files to delete>"
	echo -e ""
	echo -e " input parameters:"
	echo -e " input directory (input) higher-level directory of the downloaded zip file (i.e. DATA folder created by oft-sar-S1-download)"
	echo -e " files to delete:"
	echo -e "			  Available choices:"
	echo -e "			   1: Raw files"
	echo -e "			   2: Single RTC and LS mask files"
	echo -e "			   3: All single acquisitions folders"
	echo -e "			   4: Timeseries products"
	echo -e "			   5: Timescan products"
	echo -e "			   6: Restore subset folder"
	echo -e ""
	exit 1

else

	echo -e "------------------------------------------------------------------------------"
	echo -e " Open SAR Toolkit, version ${OST_VERSION}"
	echo -e " Clean up folders from intermediate products generated by the Open SAR Toolkit"
	echo -e "------------------------------------------------------------------------------"

	# set up initial script variables
	PROC_DIR=$(readlink -f $1)

fi

cd ${PROC_DIR}

if [ $2 -eq 1 ];then
	echo -ne " Removing original Sentinel-1 data files ... "
	rm -rf */*/S1*.zip
	rm -rf */*/RAW
	echo " done."
elif [ $2 -eq 2 ];then
  echo -ne " Removing intermediate RTC and LS-map products ... "
	rm -rf */*/*GTC*
	rm -rf */*/*RTC*
	rm -rf */*/*LS_mask*
	rm -rf */*/*LS.map.tif*
	rm -rf */*/TMP
	rm -rf */*/LOG
	echo " done."
elif [ $2 -eq 3 ];then
	echo -ne " Removing single acquisiton folder(s) ... "
	rm -rf */*[201*]
	echo " done."
elif [ $2 -eq 4 ];then
  echo -ne " Removing timeseries folder(s) ... "
	rm -rf */Timeseries
	rm -rf */LOG
	echo " done."
elif [ $2 -eq 5 ];then
	echo -ne " Removing timescan folder(s)... "
	rm -rf */Timescan
	rm -rf */LOG
	echo " done."
elif [ $2 -eq 6 ];then
	echo -ne " Restoring subsetted images to original file structure ... "
	rm -rf */*/*RTC*
	rm -rf */*/*LS_mask*
	rm -rf */*/*LS.map.tif*
	rm -rf */*/TMP
	rm -rf */*/.TMP
	rm -rf */*/LOG
	rm -rf */*/*imported_subset.*
	for TRACK in `ls -1 -d [0-9]*`; do
		cd ${TRACK}
		for ACQ in $(ls -1 -d 2*);do
			cd ${ACQ}
			mv RAW/* .
			rm -r "RAW"
			cd ../
		done
		cd ../
  done
	echo " done."
fi
